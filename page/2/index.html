<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="李霄鹏的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="李霄鹏的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="李霄鹏的博客">
<meta property="og:description" content="李霄鹏的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李霄鹏的博客">
<meta name="twitter:description" content="李霄鹏的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>李霄鹏的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李霄鹏的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/浅析JAVA对象模型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/浅析JAVA对象模型/" itemprop="url">浅析JAVA对象模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-15T00:00:00+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Java对象在JVM中的存储也是有一定的结构的。而这个关于Java对象自身的存储模型称之为Java对象模型。</p>
<p>Java对象模型,在HotSpot JVM中即<code>OOP-Klass</code>模型。</p>
<p><code>OOP</code>（Ordinary Object Pointer）指的是普通对象指针。使用new创建一个对象的时候，JVM会创建一个<code>instanceOopDesc</code>对象，保存在<code>堆</code>。</p>
<p><code>Klass</code>用来描述对象实例的具体类型。每一个Java类，在被JVM加载的时候，JVM会给这个类创建一个<code>instanceKlass</code>，保存在<code>方法区</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/12/杂谈Spring Framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/12/杂谈Spring Framework/" itemprop="url">杂谈Spring Framework</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-12T00:00:00+08:00">
                2018-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开源框架/" itemprop="url" rel="index">
                    <span itemprop="name">开源框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p><code>Bean的生命周期</code></p>
<blockquote>
<p>实例化bean对象<br>注入对象的属性<br>调用BeanNameAware.setBeanName()<br>调用BeanFactoryAware.setBeanFactory()<br>调用ApplicationContextAware.setApplicationContext()<br>调用BeanPostProcessor.postProcessBeforeInitialzation()<br>调用InitializingBean.afterPropertiesSet()<br>执行init-method<br>调用BeanPostProcessor.postProcessAfterInitialization()<br>使用该Bean<br>调用DisposableBean.destroy()<br>执行destroy-method方法</p>
</blockquote>
</li>
<li><p><code>Bean的作用域</code></p>
<blockquote>
<p>singleton，容器在启动时,自动实例化一个实例。<br>prototype，对bean请求的时，创建一个新的的实例。<br>request，对一次的http的请求，创建一个全新的bean实例。<br>session，对某个http seeision 同生通灭。<br>globalSession，对应全局Session的生命周期范围内。</p>
</blockquote>
</li>
</ul>
<ul>
<li><p><code>Spring MVC的工作原理</code></p>
<blockquote>
<p>客户端请求统一到达DispatcherServlet。<br>根据HandlerMapping获取对应的Handler。<br>Handler完成请求后，返回ModelAndView对象给DispatcherServlet。<br>根据ViewResolver完成视图解析<br>DispatcherServlet会利用视图对象对模型数据进行渲染。</p>
</blockquote>
</li>
<li><p><code>BeanFactory 与 ApplicationContexts</code></p>
<blockquote>
<p>ApplicationContext继承BeanFactory<br>ApplicationContexts提供了更高级的功能。<br>BeanFactory在启动时不加载实例，后者反之。</p>
</blockquote>
</li>
<li><p><code>事务管理</code></p>
<blockquote>
<p>事务四特性(ACID)：原子性，一致性，隔离性，持久性<br>编程式事务管理：灵活性，但是难维护。<br>声明式事务管理：业务代码和事务管理分离。</p>
</blockquote>
</li>
<li><p><code>隔离级别</code></p>
<blockquote>
<p>READ_UNCOMMITTED：允许读取尚未提交的更改。<br>READ_COMMITTED：允许从已经提交的并发事务读取。<br>REPEATABLE_READ：对相同字段的多次读取的结果是一致的。<br>SERIALIZABLE：确保不发生脏读、不可重复读和幻影读。</p>
</blockquote>
</li>
<li><p><code>传播行为</code></p>
<blockquote>
<p>REQUIRED 如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。<br>REQUIRES_NEW 创建一个新的事务，如果当前存在事务，则把当前事务挂起。<br>SUPPORTS 如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。<br>NOT_SUPPORTED 以非事务方式运行，如果当前存在事务，则把当前事务挂起。<br>NEVER 以非事务方式运行，如果当前存在事务，则抛出异常。<br>MANDATORY 如果当前存在事务，则加入该事务；如果当前没有事务，则抛出异常。<br>NESTED 如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行；如果当前没有事务，则该取值等价于TransactionDefinition.PROPAGATION_REQUIRED。</p>
</blockquote>
</li>
<li><p><code>工具类中注入bean</code></p>
<blockquote>
<p>加上@component和@PostConstruct注解。<br>@PostConstruct服务器启动时的做一些初始化工作。</p>
</blockquote>
</li>
<li><p><code>AOP的代理实现</code></p>
<blockquote>
<p>动态代理，基于JDK动态代理或CGLIB动态代理，jdk动态代理必须是目标类基于接口。<br>静态代理，编译时进行织入，AspectJ</p>
</blockquote>
</li>
<li><p><code>BeanPostProcessor</code></p>
<blockquote>
<p>在Spring容器中完成bean实例化、配置以及其他初始化方法前后要添加一些自己逻辑处理。<br>@Value的实现逻辑依赖于此。</p>
</blockquote>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/12/并发编程必知必会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/12/并发编程必知必会/" itemprop="url">并发编程必知必会</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-12T00:00:00+08:00">
                2018-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程创建的方式"><a href="#线程创建的方式" class="headerlink" title="线程创建的方式"></a>线程创建的方式</h4><p><code>继承Thread类</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadTest extends Thread &#123;</span><br><span class="line"></span><br><span class="line">    //重写run方法</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //调用start方法启动线程</span><br><span class="line">        new ThreadTest().start();</span><br><span class="line">        System.out.println(&quot;main&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>实现Runable接口</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class RunnableTest implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    //实现run方法</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;run&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //使用Runnable对象，创建Thread对象</span><br><span class="line">        new Thread(new RunnableTest()).start();</span><br><span class="line">        System.out.println(&quot;main&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>实现Callable接口，结合FutureTask</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class CallableTest implements Callable&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    //实现call方法</span><br><span class="line">    @Override</span><br><span class="line">    public String call() throws Exception &#123;</span><br><span class="line">        return &quot;call&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //使用Callable对象，创建FutureTask对象</span><br><span class="line">        FutureTask&lt;String&gt; future = new FutureTask&lt;&gt;(new CallableTest());</span><br><span class="line">        //使用FutureTask对象，创建Thread对象</span><br><span class="line">        new Thread(future).start();</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">        System.out.println(&quot;main&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h4><p>新建（new），就绪（runable），运行（running），阻塞（blocked），死亡（dead）五个状态。<br><img src="https://github.com/echolixiaopeng/blog/raw/master/data/java-thread-life-cycle.png" alt></p>
<p><code>new -&gt; runable</code><br>新建的线程调用start方法，进入runable状态。</p>
<p><code>runable -&gt; running</code><br>就绪的线程，由线程调度器调度，获取到CPU资源后进入running状态。</p>
<p><code>running -&gt; runable</code><br>运行的线程，失去CPU资源或调用yield方法后，回到runable状态。</p>
<p><code>running -&gt; blocked</code><br>运行的线程，调用sleep方法后，或调用阻塞IO方法时，或等待同步监视器，或等待notify时，或调用suspend方法后，进入阻塞状态。</p>
<p><code>blocked -&gt; runable</code><br>sleep过了设定的时间，阻塞的IO方法已返回，已获取同步监视器，已收到notify，已调用resume方法恢复，进去就绪状态。</p>
<p><code>running -&gt; dead</code><br>方法已经执行完毕，或执行时抛出未捕获的异常，或调用stop方法结束该线程。</p>
<h4 id="线程控制"><a href="#线程控制" class="headerlink" title="线程控制"></a>线程控制</h4><p><code>thread.join()</code><br>当前线程等待指定线程完成。<br>调用线程将被阻塞，直到join方法加入的线程执行完毕为止。<br>join(long millis)，超过时间后将不再等待该线程。</p>
<p><code>Thread.sleep()</code><br>当前线程进入阻塞状态。<br>sleep(long millis)，当前线程将阻塞状态，暂停指定时间。<br>即使系统中没有其他可执行的线程，sleep后的线程也不会执行。</p>
<p><code>Thread.yield()</code><br>当前线程进入就绪状态。<br>多CPU环境下，该操作的效果不明显。</p>
<p><code>Thread.currentThread.setPriority()</code><br>设置当前线程的优先级。<br>使用JDK常量指定优先级，保证移植性。</p>
<p><code>thread.setDaemon()</code><br>设置线程为后台线程。<br>设置必须在调用start方法之前。<br>所有的前台线程都死亡，后台线程都会死亡。<br>前台线程默认创建的事前台线程，后台线程亦然。</p>
<h4 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h4><blockquote>
<p>死锁：两个线程互相等待对方释放同步监视器。</p>
</blockquote>
<p><code>同步代码块</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">synchronized(obj)&#123;</span><br><span class="line">//同步的代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑：加锁 -&gt; 修改 -&gt; 释放锁<br>obj是同步监视器。<br>任何时刻只能有一个线程获取同步监视器。<br>线程开始执行同步代码块之前，必须先获得同步监视器。<br>同步代码块执行完成之后，会释放同步监视器。</p>
<p><code>同步方法</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void test()&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑：加锁 -&gt; 修改 -&gt; 释放锁<br>this是同步监视器。</p>
<p><code>同步锁</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reentrantLock.lock();</span><br><span class="line">try&#123;&#125;</span><br><span class="line">finally&#123;</span><br><span class="line">reentrantLock.unlock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显式的定义同步锁，显式的加锁，显式的释放锁。<br>只能有一个线程对Lock对象进行加锁。<br>ReentrantLock是Lock的实现。<br>ReentrantLock是重入锁，可对已经加锁的锁再次加锁。</p>
<h4 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h4><p><code>传统的线程通信</code><br>obj.wait()方法：释放同步监视器，当前线程进入Blocked状态，不会再次竞争。<br>obj.notify()方法：唤醒在此同步监视器上的单个线程，选择是随机的。<br>obj.notifyAll()方法：唤醒在此同步监视器上的所有线程。<br>notify后，被唤醒的线程会再次竞争同步监视器。</p>
<p><code>使用Condition控制</code><br>通过Lock对象的lock.newCondition()获取condition对象。<br>condition.await()相当于obj.wait()。<br>condition.signal()相当于obj.notify()。<br>condition.signalAll()相当于obj.notifyAll()。</p>
<p><code>使用BlockingQueue</code><br>put时，队列已满，则阻塞该线程。<br>take时，队列已空，则阻塞该线程。</p>
<h4 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h4><blockquote>
<p>线程池适合任务处理时间短，且任务数量大的场景。<br>线程池优点：降低资源消耗，减少线程创建和销毁的消耗。<br>线程池优点：加快响应速度，不用等待线程创建。<br>线程池优点：线程可管理，无限制创建线程会降低系统稳定性，线程池可统一管理。<br>Executors 返回的线程池对象，会引起OOM问题。<br>推荐通过 ThreadPoolExecutor 的方式，创建线程池。</p>
</blockquote>
<h5 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h5><ul>
<li><p><code>构造参数</code><br>corePoolSize：核心线程数量；<br>maximumPoolSize：最大线程数量；<br>workQueue：等待队列；<br>handler：表示线程池的饱和策略；</p>
</li>
<li><p><code>方法</code><br>execute()，提交任务。<br>shutdown（），将线程池设置成SHUTDOWN状态，然后中断所有正在执行的任务。<br>shutdownNow（），将线程池的状态设置为STOP，，然后尝试停止所有正在执行或暂停任务的线程，并返回等待执行任务的列表。</p>
</li>
</ul>
<ul>
<li><p><code>执行过程</code><br>如果workerCount &lt; corePoolSize，则创建并启动一个线程来执行新提交的任务；<br>如果workerCount &gt;= corePoolSize，且线程池内的阻塞队列未满，则将任务添加到该阻塞队列中；<br>如果workerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize，且线程池内的阻塞队列已满，则创建并启动一个线程来执行新提交的任务；<br>如果workerCount &gt;= maximumPoolSize，并且线程池内的阻塞队列已满, 则根据拒绝策略来处理该任务, 默认的处理方式是直接抛异常。</p>
</li>
<li><p><code>线程池分配</code><br>CPU密集型任务：N+1个线程。<br>IO密集型任务：2N个线程。<br>混合型任务：拆分成一个CPU密集型任务和一个IO密集型任务。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/01/浅析JMM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/01/浅析JMM/" itemprop="url">浅析JMM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-01T00:00:00+08:00">
                2018-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Java Memory Model（JMM），Java内存模型，是一个抽象的概念。JMM是围绕着多线程通信以及与其相关的一系列特性而建立的模型。JMM定义了一些语法集，这些语法集映射到Java语言中就是volatile、synchronized等关键字。</p>
<p><img src="https://github.com/echolixiaopeng/blog/raw/master/data/jmm.jpeg" alt></p>
<p>JMM规定了所有的变量都存储在<code>主内存</code>（Main Memory）中。每个线程还有自己的<code>工作内存</code>（Working Memory）,线程的工作内存中保存了该线程使用到的变量的主内存的副本拷贝，线程对变量的所有操作（读取、赋值等）都必须在工作内存中进行，而不能直接读写主内存中的变量（volatile变量仍然有工作内存的拷贝，但是由于它特殊的操作顺序性规定，所以看起来如同直接在主内存中读写访问一般）。不同的线程之间也无法直接访问对方工作内存中的变量，线程之间值的传递都需要通过主内存来完成。</p>
<p>Java内存模型是围绕着并发编程中<code>原子性</code>、<code>可见性</code>、<code>有序性</code>这三个特征来建立。</p>
<h4 id="原子性"><a href="#原子性" class="headerlink" title="原子性"></a>原子性</h4><ul>
<li>一个操作不能被打断，要么全部执行完毕，要么不执行。</li>
<li>基本类型数据的访问都是<code>原子操作</code>。</li>
<li>32位JVM中，long 和double类型的变量的读写操作是非原子操作。</li>
</ul>
<h4 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h4><ul>
<li>一个线程对共享变量做了修改之后，其他的线程立即能够看到（感知到）该变量这种修改（变化）。</li>
<li>Java内存模型是通过将在工作内存中的变量修改后的值同步到主内存，在读取变量前从主内存刷新最新值到工作内存中，这种依赖主内存的方式来实现可见性的。</li>
<li>volatile，synchronized，Lock，final关键字能实现可见性。</li>
<li>volatile：每次使用volatile变量前立即从主内存中刷新，修改后的新值立刻同步到主内存。</li>
<li>synchronized：同步块开始时，使用共享变量时会从主内存中刷新变量值到工作内存中；同步块结束时，将工作内存中的变量值同步到主内存中去。</li>
<li>Lock接口：最常用的实现ReentrantLock(重入锁)来实现可见性。</li>
</ul>
<h4 id="有序性"><a href="#有序性" class="headerlink" title="有序性"></a>有序性</h4><ul>
<li>在本线程内观察，操作都是有序的；如果在一个线程中观察另外一个线程，所有的操作都是无序的。</li>
<li>无序指“<code>指令重排</code>”现象和“工作内存和主内存同步延迟”现象。</li>
<li>volatile和synchronized来保证多线程之间操作的有序性。</li>
</ul>
<h4 id="happens-before原则"><a href="#happens-before原则" class="headerlink" title="happens-before原则"></a>happens-before原则</h4><ul>
<li>解释：A happens-before B，A操作执行的结果对B操作可见。</li>
<li><code>程序顺序规则</code>： 一个线程中的每个操作，happens-before于该线程中的任意后续操作。</li>
<li><code>监视器锁规则</code>：对一个锁的解锁，happens-before 于随后对这个锁的加锁。</li>
<li><code>volatile变量规则</code>：对一个 volatile域的写，happens-before于任意后续对这个volatile域的读。</li>
<li><code>传递性</code>：如果 A happens-before B,且 B happens-before C,那么A happens-before C</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/08/浅析JAVA集合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/08/浅析JAVA集合/" itemprop="url">浅析JAVA集合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-08T00:00:00+08:00">
                2018-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Set，无序、不可重复的集合。<br>List，有序、可重复的集合。<br>Queue，队列集合实现。<br>Map，具有映射关系的集合。<br>数组需要在初始化的时候指定长度，集合可以保存不确定数量的数据。<br>集合只能保存对象，数组可以保存基本数据类型和对象。</p>
</blockquote>
<h4 id="Collection-接口"><a href="#Collection-接口" class="headerlink" title="Collection 接口"></a>Collection 接口</h4><p><code>Collection</code>是<code>Set</code>，<code>List</code>，<code>Queue</code>的父接口。<br><code>add(E e)</code>，添加元素。<br><code>size()</code>方法，返回元素数。<br><code>toArray(T[] a)</code>方法，返回所有元素的数组。<br><code>remove(Object o)</code>方法，移出单个元素。<br><code>removeAll(Collection&lt;?&gt; c)</code>，移出指定元素。<br><code>retainAll(Collection&lt;?&gt; c)</code>，取交集。<br><code>isEmpty()</code>方法，size=0返回true。<br><code>iterator()</code>方法，该方法的返回值是<code>Iterator\&lt;E\&gt;</code>。
Iterator 适合访问<code>链式结构</code>，for循环适合访问<code>顺序结构</code>。
在LinkedList里，使用iterator较快；在ArrayList里，for循环较快。<br>foreach和iterator遍历集合时不能修改元素。<br>使用Collections的sync方法包装集合为线程安全的集合类。</p>
<h5 id="Set-接口"><a href="#Set-接口" class="headerlink" title="Set 接口"></a>Set 接口</h5><blockquote>
<p>Set集合不允许包含相同的元素,集合是无序的。<br>Set的实现原理是基于Map的。</p>
</blockquote>
<p><code>HashSet</code><br>线程不安全；<br>实现：建立一个Map，“键”就是我们要存入的对象，“值”则是一个常量；<br>允许包含值为null的元素，但最多只能有一个null元素；</p>
<p><code>LinkedHashSet</code><br>线程不安全；<br>也是一个hash表，但是同时维护了一个双链表来记录插入的顺序；<br>遍历该集合时候，LinkedHashSet将会以元素的添加顺序访问集合的元素；<br>插入性能略低于HashSet，但是遍历性能优于HashSet；</p>
<p><code>TreeSet</code><br>线程不安全；<br>基于Map来实现；<br>其底层结构为红黑树，性能不如HashSet；<br>遍历该集合时候，会以排序顺序方位集合元素。<br>素需要实现Comparable接口，或者集合中传入自定义比较器；</p>
<h5 id="List-接口"><a href="#List-接口" class="headerlink" title="List 接口"></a>List 接口</h5><blockquote>
<p>List集合允许包含相同的元素，集合是有序的。<br>每个元素都有其对应的顺序索引。</p>
</blockquote>
<p><code>ArrayList</code><br>线程不安全；<br>基于动态数组实现；<br>添加元素时会扩容数组，删除元素时不会缩小数组，trimToSize方法可以手动缩小；<br>内部数组默认大小为10，减少动态分配次数，可提高性能；</p>
<p><code>LinkedList</code><br>线程不安全；<br>基于双向链表实现；<br>插入和删除性能优于ArrayList，查询性能不如ArrayList；</p>
<p><code>Vector</code><br>线程安全；</p>
<h5 id="Queue-接口"><a href="#Queue-接口" class="headerlink" title="Queue 接口"></a>Queue 接口</h5><blockquote>
<p>FIFO容器，队列头部的元素保存时间最长，尾部反之；<br>Deque是Queue的子接口，为双端队列，LinkedList为Deque的实现；<br>add()方法，添加元素到尾部；<br>element()方法，获取头部元素，但不删除；<br>peek()方法，获取头部元素，但不删除；<br>poll()方法，获取头部元素，并删除；<br>remove()方法，删除头部元素；</p>
</blockquote>
<p><code>PriorityQueue</code><br>队列的顺序按照大小排序，不按照插入顺序。</p>
<h4 id="Map-接口"><a href="#Map-接口" class="headerlink" title="Map 接口"></a>Map 接口</h4><blockquote>
<p>Key和Value必须是引用类型；<br>Key不允许重复；</p>
</blockquote>
<p><code>HashMap</code><br>线程不安全；<br>Key和Value都可以是null；<br>实现基于数组和链表，key值hash取模值分布在数组上，entry形成链表；<br>扩容时，生成新的数组，并重新计算写入。<br>效率优于HashTable；</p>
<p><code>HashTable</code><br>线程安全；<br>Key和Value都不可以是null；</p>
<p><code>LinkedHashMap</code><br>线程不安全；<br>实现基于HashMap+LinkedList，LinkedList维护插入元素的先后顺序；<br>迭代顺序就是是插入顺序；<br>性能低于HashMap，需要维护顺序链表；</p>
<p><code>TreeMap</code><br>红黑树结构；<br>根据Key的大小进行排序；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/浅识Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/浅识Nginx/" itemprop="url">浅识Nginx</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>国籍：俄罗斯<br>语言：C语言<br>开源软件，BSD许可<br>跨平台支持Linux和Windows<br>可作为WEB服务器，负载均衡器，邮件代理服务器等</p>
</blockquote>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p><code>轻量级</code><br>占用更少的内存资源</p>
<p><code>高并发</code><br>异步非阻塞，epoll模，单机高并发</p>
<p><code>模块化</code><br>高度模块化的设计，便于扩展</p>
<p><code>超稳定</code><br>分为主进程，工作进程</p>
<h4 id="为什么高性能"><a href="#为什么高性能" class="headerlink" title="为什么高性能"></a>为什么高性能</h4><p><code>多进程模型</code><br>nginx默认以多进程的方式工作，一个master进程和多个worker进程，master进程主要用来管理worker进程。<br><code>异步非阻塞</code><br>在epoll支持下，采用异步非阻塞的方式来处理请求，从而实现高并发。</p>
<h4 id="进程模型"><a href="#进程模型" class="headerlink" title="进程模型"></a>进程模型</h4><blockquote>
<p>多进程模型<br>独立的工作进程，不共享资源，不加锁</p>
</blockquote>
<p><code>master进程</code><br>主进程，充当监控进程。<br>不需要处理网络事件，不负责业务的执行。<br>只负责管理worker进程。</p>
<p><code>worker进程</code><br>负责处理网络IO。<br>各worker进程竞争来自客户端的请求。<br>多cpu的情况下，设置woker进程的数量等于cpu的核数。<br>Nginx支持将某一个进程绑定在某一个核上。</p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><code>nginx</code> 启动</p>
<p><code>nginx -s stop</code> 关闭</p>
<p><code>ngixn -s relaod</code> 重载配置文件</p>
<p><code>nginx -t</code> 检查配置文件</p>
<p><code>nginx -v</code> 查看版本</p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><ol>
<li>worker_processes配置为CPU核数。</li>
<li>将worker process与指定cpu核绑定。</li>
<li>关闭访问日志，加快磁盘IO。</li>
<li>开启gzip，减少网络传输时间。</li>
<li>worker_rlimit_nofile，更改worker进程的最大打开文件数限制</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - 反向代理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - 反向代理/" itemprop="url">Nginx应用 - 反向代理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="为什么要用？"><a href="#为什么要用？" class="headerlink" title="为什么要用？"></a>为什么要用？</h4><ol>
<li>保护源服务的安全，相当于堡垒服务。</li>
<li>缓存静态资源，加速web请求。</li>
<li>灵活的服务中间件，实现服务热部署。</li>
</ol>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       7421;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass_header Server;</span><br><span class="line">        //保留Host请求头</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        //保留用户真实IP</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        //转发到7422端口</span><br><span class="line">        proxy_pass   http://127.0.0.1:7422;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - URL拦截/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - URL拦截/" itemprop="url">Nginx应用 - URL拦截</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>临时下线某个业务接口，不重新发布服务。</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line"></span><br><span class="line">#匹配请求url中包含指定字符的请求</span><br><span class="line">if ($request_uri ~* &quot;/bad_request&quot;) &#123;</span><br><span class="line">    return 200 &quot;error&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - 负载均衡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - 负载均衡/" itemprop="url">Nginx应用 - 负载均衡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="负载策略"><a href="#负载策略" class="headerlink" title="负载策略"></a>负载策略</h4><p><code>轮循（默认）</code><br>根据Nginx配置文件中的顺序，依次把客户端的Web请求分发到不同的后端服务器上。</p>
<p><code>权重</code><br>配置Nginx把请求更多地分发到高配置的后端服务器上，把相对较少的请求分发到低配服务器。</p>
<p><code>IP Hash</code><br>同一客户端连续的Web请求都会被分发到同一服务器进行处理。</p>
<p><code>最少连接</code><br>请求会被转发到连接数最少的服务器上。</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><ul>
<li>轮循（默认）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass_header Server;</span><br><span class="line">        #保留Host请求头</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        #保留用户真实IP</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        #对应upstream的配置</span><br><span class="line">        proxy_pass   http://service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>权重</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    server 192.168.1.10 weight=1;</span><br><span class="line">    server 192.168.1.11 weight=2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>IP Hash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最少连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/Redis必知必会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/Redis必知必会/" itemprop="url">Redis必知必会</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-02T00:00:00+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>开源KV数据库<br>由C语言编写<br>支持丰富的数据类型：string，set，list，sorted set，hash<br>数据操作具有原子性<br>支持数据持久化<br>可集群扩展 </p>
</blockquote>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li>速度快，整个数据库统统加载在内存当中进行操作；</li>
<li>支持保存多种数据结构；</li>
<li>操作都是原子性；</li>
<li>支持事务；</li>
<li>丰富的特性，支持有序集合，支持ttl，支持发布订阅；</li>
</ul>
<h4 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h4><p><code>string</code></p>
<ul>
<li>赋值：SET key value。如set hello world</li>
<li>取值：GET key。如get hello。返回是world</li>
<li>自增：INCR key。该key的值都会+1。该操作是原子操作。</li>
<li>自减：DECR key。该key的值都会-1。该操作是原子操作。</li>
</ul>
<p><code>list</code></p>
<ul>
<li>向头部插入：LPUSH key value1 value2…</li>
<li>向尾部插入：RPUSH key value1 value2…</li>
<li>从头部弹出：LPOP key。返回被弹出的元素值。</li>
<li>从尾部弹出：RPOP key。返回被弹出的元素值。</li>
<li>列表元素个数：LLEN key。key不存在返回0。</li>
<li>获取列表的子列表：LRANGE start end。</li>
</ul>
<p><code>set</code></p>
<ul>
<li>增加：SADD key value。</li>
<li>删除：SREM key value。</li>
<li>获取指定集合的所有元素：SMEMBERS key。</li>
<li>判断某个元素是否存在：SISMEMBER key value。</li>
<li>差集运算：SDIFF key1 key2…。对多个集合进行差集运算。</li>
<li>交集运算：SINNER key1 key2…。对多个集合进行交集运算。</li>
<li>并集运算：SUNION key1 key2…。对多个集合进行并集运算。</li>
<li>获取集合中元素个数：SCARD key。返回集合中元素的总个数。</li>
</ul>
<p><code>sorted set</code></p>
<ul>
<li>增加：ZADD key sorce1 value1 sorce2 value2…。</li>
<li>获取分数：ZSCORE key value。</li>
<li>获取分数范围内的元素：ZRANGEBYSCORE key min max </li>
<li>为某个元素增加分数：ZINCRBY key increment value。</li>
</ul>
<p><code>hash</code></p>
<ul>
<li>赋值：HSET key field value。</li>
<li>取值：HGET key field。</li>
<li>同一个key多个字段赋值：HMSET key field1 value1 field2 value2…。</li>
<li>同一个KEY多个字段取值：HMGET key field1 fields2…。</li>
<li>获取KEY的所有字段和所有值：HGETALL key。</li>
<li>字段是否存在：HEXISTS key field。存在返回1，不存在返回0。<br>当字段不存在时赋值：HSETNX key field value。如果key下面的字段field不存在，则建立field字段，且值为value。如果field字段存在，则不执行任何操作。这个命令的是原子操作。</li>
</ul>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p><code>RDB</code></p>
<blockquote>
<p>#在900秒之后，如果至少有1个key发生变化，则dump内存快照<br>save 900 1  </p>
</blockquote>
<ul>
<li>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</li>
<li>性能最大化。对于Redis的服务进程而言，在开始持久化时，它唯一需要做的只是fork出子进程，之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行IO操作了。</li>
<li>相比于AOF机制，如果数据集很大，RDB的启动效率会更高。</li>
<li>如果当数据集较大时，可能会导致整个服务器停止服务。</li>
</ul>
<p><code>AOF</code></p>
<blockquote>
<p>appendfsync always     #每次有数据修改发生时都会写入AOF文件。<br>appendfsync everysec  #每秒钟同步一次，该策略为AOF的缺省策略。<br>appendfsync no          #从不同步。高效但是数据不会被持久化。</p>
</blockquote>
<ul>
<li>AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</li>
<li>该机制可以带来更高的数据安全性。</li>
<li>Redis 4.0 推出RDB-AOF 混合持久化。</li>
</ul>
<h4 id="内存淘汰"><a href="#内存淘汰" class="headerlink" title="内存淘汰"></a>内存淘汰</h4><p>maxmemory参数，可以控制其最大可用内存大小（字节）。<br>超过maxmemory时，根据maxmemory-policy参数进行内存淘汰。</p>
<blockquote>
<p>volatile-lru     使用LRU算法删除一个键（只对设置了生存时间的键）<br>allkeys-lru       使用LRU算法删除一个键<br>volatile-random   随机删除一个键（只对设置了生存时间的键）<br>allkeys-random    随机删除一个键<br>volatile-ttl      删除生存时间最近的一个键<br>noeviction（默认配置）  不删除键，只返回错误</p>
</blockquote>
<h4 id="集群扩展"><a href="#集群扩展" class="headerlink" title="集群扩展"></a>集群扩展</h4><p><code>官方cluster方案</code><br>配置成主从结构，即一个master主节点，挂n个slave从节点。如果主节点失效，redis cluster会根据选举算法从slave节点中选择一个上升为master节点，整个集群继续对外提供服务。</p>
<p><code>twemproxy</code><br>twitter开源的代理分区方案。</p>
<p><code>codis</code><br>豌豆荚开源的代理分区方案。</p>
<p><code>客户端分片</code><br>分区的逻辑在客户端实现，由客户端自己选择请求到哪个节点。</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ul>
<li>keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。</li>
<li>使得过期时间分散一些，否则可能会出现短暂的卡顿现象。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">hi@xiaopeng.li</p>
              <p class="site-description motion-element" itemprop="description">李霄鹏的博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hi@xiaopeng.li</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
